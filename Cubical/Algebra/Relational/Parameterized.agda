{-

A parameterized family of Algebra S can be combined into a single structure:
X ??? (a : A) ??? S a X

-}
{-# OPTIONS --cubical --no-import-sorts --safe #-}
module Cubical.Algebra.Relational.Parameterized where

open import Cubical.Foundations.Prelude
open import Cubical.Foundations.Equiv
open import Cubical.Foundations.HLevels
open import Cubical.Foundations.Structure
open import Cubical.Foundations.RelationalStructure
open import Cubical.Functions.FunExtEquiv
open import Cubical.Data.Sigma
open import Cubical.HITs.PropositionalTruncation
open import Cubical.HITs.SetQuotients

open import Cubical.Algebra.Parameterized

private
  variable
    ??? ?????? ?????? ??????' ??????'' : Level

-- Structured relations

module _ (A : Type ??????) where

  ParamRelStr : {S : A ??? Type ??? ??? Type ??????}
    ??? (??? a ??? StrRel (S a) ??????')
    ??? StrRel (ParamStructure A S) (???-max ?????? ??????')
  ParamRelStr ?? R s t =
    (a : A) ??? ?? a R (s a) (t a)

  paramSuitableRel : {S : A ??? Type ??? ??? Type ??????} {?? : ??? a ??? StrRel (S a) ??????'}
    ??? (??? a ??? SuitableStrRel (S a) (?? a))
    ??? SuitableStrRel (ParamStructure A S) (ParamRelStr ??)
  paramSuitableRel {?? = ??} ?? .quo (X , f) R r .fst .fst a =
    ?? a .quo (X , f a) R (r a) .fst .fst
  paramSuitableRel {?? = ??} ?? .quo (X , f) R r .fst .snd a =
    ?? a .quo (X , f a) R (r a) .fst .snd
  paramSuitableRel {?? = ??} ?? .quo (X , f) R r .snd (q , c) i .fst a =
    ?? a .quo (X , f a) R (r a) .snd (q a , c a) i .fst
  paramSuitableRel {?? = ??} ?? .quo (X , f) R r .snd (q , c) i .snd a =
    ?? a .quo (X , f a) R (r a) .snd (q a , c a) i .snd
  paramSuitableRel {?? = ??} ?? .symmetric R r a =
    ?? a .symmetric R (r a)
  paramSuitableRel {?? = ??} ?? .transitive R R' r r' a =
    ?? a .transitive R R' (r a) (r' a)
  paramSuitableRel {?? = ??} ?? .set setX =
    isSet?? ?? a ??? ?? a .set setX
  paramSuitableRel {?? = ??} ?? .prop propR s t =
    isProp?? ?? a ??? ?? a .prop propR (s a) (t a)

  paramRelMatchesEquiv : {S : A ??? Type ??? ??? Type ??????}
    (?? : ??? a ??? StrRel (S a) ??????') {?? : ??? a ??? StrEquiv (S a) ??????''}
    ??? (??? a ??? StrRelMatchesEquiv (?? a) (?? a))
    ??? StrRelMatchesEquiv (ParamRelStr ??) (ParamEquivStr A ??)
  paramRelMatchesEquiv ?? ?? _ _ e = equiv??Cod ?? a ??? ?? a _ _ e

  paramRelAction : {S : A ??? Type ??? ??? Type ??????} {?? : ??? a ??? StrRel (S a) ??????'}
    ??? (??? a ??? StrRelAction (?? a))
    ??? StrRelAction (ParamRelStr ??)
  paramRelAction ?? .actStr f s a = ?? a .actStr f (s a)
  paramRelAction ?? .actStrId s = funExt ?? a ??? ?? a .actStrId (s a)
  paramRelAction ?? .actRel h _ _ r a = ?? a .actRel h _ _ (r a)

  -- Detransitivity of ParamRelStr would depend on choice in general, so
  -- we don't get positivity
